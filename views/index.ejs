<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Lista de Registros</title>
<link rel="stylesheet" href="/css/index.css">
</head>
<body>
<div class="container">
    <div class="left">
        <h2>Registros</h2>
        <button class="btn" onclick="location.href='/cadastro'">
            Cadastrar Novo
        </button>
        <table id="tabela">
            <tr>
                <th>ID</th>
                <th>Nome</th>
                <th>Email</th>
                <th>Telefone</th>
                <th>CPF</th>
                <th>Data de Nascimento</th>
                <th></th>
            </tr>   
            <% usuarios.forEach(usuario =>{ %>
                <tr>
                    <td><%= usuario.id %></td>
                    <td><%= usuario.nome %></td>
                    <td><%= usuario.email %></td>
                    <td><%= usuario.telefone %></td>
                    <td><%= usuario.cpf %></td>
                    <td><%= usuario.data_nascimento %></td>
                    <td>
                        <form action="/alteracao/<%= usuario.id %>" method="get">
                            <button class="btn" onclick="location.href='/alteracao:<%= usuario.id %>'">Editar</button>
                        </form>
                        <form action="/deletar/<%= usuario.id %>" method="post">
                            <button class="btn">Excluir</button>
                        </form>
                    </td>
                </tr>
                <% }) %>

            </table>
    </div>
</div>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

<script>
    // Função que verifica a URL quando a página carrega
    window.onload = function() {
        // Pega os parâmetros da URL (ex: ?status=success&action=cadastro)
        const urlParams = new URLSearchParams(window.location.search);
        const status = urlParams.get('status');
        const action = urlParams.get('action');
        const message = urlParams.get('message');

        // LÓGICA DE SUCESSO
        if (status === 'success') {
            let titulo = 'Sucesso!';
            let texto = 'Operação realizada.';

            if(action === 'cadastro') texto = 'Usuário cadastrado com sucesso!';
            if(action === 'edicao') texto = 'Dados do usuário atualizados!';
            if(action === 'exclusao') texto = 'Usuário removido do sistema.';

            Swal.fire({
                title: titulo,
                text: texto,
                icon: 'success',
                confirmButtonText: 'OK',
                confirmButtonColor: '#3085d6'
            }).then(() => {
                // (Opcional) Limpa a URL para o popup não aparecer de novo se der F5
                window.history.replaceState(null, null, window.location.pathname);
            });
        }

        // LÓGICA DE ERRO
        if (status === 'error') {
            Swal.fire({
                title: 'Ops! Algo deu errado.',
                text: message || 'Ocorreu um erro no servidor.',
                icon: 'error',
                confirmButtonText: 'Fechar'
            }).then(() => {
                window.history.replaceState(null, null, window.location.pathname);
            });
        }
    }
</script>
</body>
</html>